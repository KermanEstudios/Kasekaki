-- Configura la variable global para controlar el bucle principal
getgenv().loopgoto = true;

-- Obtén el servicio de jugadores
local playersService = game:GetService("Players")

-- Función para obtener el personaje y el HumanoidRootPart del jugador
local function getCharacterAndRootPart(player)
    local character = player.Character or player.CharacterAdded:Wait()
    local humanoidRootPart = character:WaitForChild("HumanoidRootPart")
    return character, humanoidRootPart
end

-- Obtén el jugador local y su personaje inicial
local player = playersService.LocalPlayer
local character, humanoidRootPart = getCharacterAndRootPart(player)

-- Actualiza las referencias cuando el personaje respawnea
player.CharacterAdded:Connect(function(newCharacter)
    character, humanoidRootPart = getCharacterAndRootPart(player)
end)

-- Función para teletransportar al jugador a un jugador aleatorio
local function teleportToRandomPlayer()
    -- Verifica que el HumanoidRootPart esté disponible
    if not humanoidRootPart or not humanoidRootPart.Parent or humanoidRootPart.Parent ~= character then
        return
    end

    -- Obtén la lista de jugadores en el juego
    local players = playersService:GetPlayers()

    -- Filtra la lista para excluir al jugador actual y jugadores sin personajes
    local validPlayers = {}
    for _, p in ipairs(players) do
        if p ~= player and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
            table.insert(validPlayers, p)
        end
    end

    -- Verifica si hay jugadores válidos para teletransportar
    if #validPlayers > 0 then
        -- Elige un jugador aleatorio
        local targetPlayer = validPlayers[math.random(1, #validPlayers)]
        local targetPosition = targetPlayer.Character.HumanoidRootPart.Position
        -- Teletransporta al jugador al objetivo con un pequeño desplazamiento
        humanoidRootPart.CFrame = CFrame.new(targetPosition) * CFrame.new(0, 0, 3)
    end
end

-- Ejecuta el bucle principal para teletransportar al jugador a un jugador aleatorio
while getgenv().loopgoto do
    task.wait(2)  -- Espera 2 segundos entre teletransportes
    spawn(teleportToRandomPlayer)  -- Llama a la función de teletransporte en paralelo
end
